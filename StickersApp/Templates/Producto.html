{% extends 'Base.html' %}
{% load static %}
{% block contenido %}
    {% if product and product.removed == False %}
        <div class="container">  
            {% comment %} <div class="display-2 my-2 text-center">  Producto </div> {% endcomment %}
            {% comment %}=================================== Product Info =================================  {% endcomment %}
            <div class="row justify-content-center mt-4">
                <div class="card text-center p-3">
                    <div class="col-auto">
                        {% if user.is_admin %}
                            <div class="row justify-content-end">
                                <div class="col-auto">
                                    <div class="d-flex">
                                        <div class="dropdown me-1">
                                        <button type="button" class="btn btn-light dropdown-toggle" id="dropdownMenuOffset" data-bs-toggle="dropdown" aria-expanded="false" data-bs-offset="10,20">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="currentColor" class="bi bi-three-dots" viewBox="0 0 16 16">
                                                <path d="M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"/>
                                            </svg>
                                        </button>

                                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuOffset">
                                            <li>
                                            {% comment %} <a class="dropdown-item" href="" onclick="SubmitReplica()" data-bs-toggle="modal" data-bs-target="#modalId">Crear Replica del Producto</a> {% endcomment %}
                                            <a class="dropdown-item" onclick="SubmitReplica()">Crear Replica del Producto</a>
                                            
                                            </li>
                                        </ul>
                                        </div>
                                    </div>

                                </div>
                            </div>
                            <form action="" method="post" id="IDFormREplica">
                                {% csrf_token %}
                                <input type="hidden" name="ReplicaProduct">
                            </form>
                        {% endif %}
                        <div class="row justify-content-center">
                            <div class="col-8 col-md-6">
                                <div class="row justify-content-center h-100 align-items-center">
                                    <div class="col-12 col-md-8">
                                        <img src="{{product.image.url}}" class="img-fluid img-thumbnail rounded-top" alt="">
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-md-5 m-2 mt-4">
                                <div class="row justify-content-center align-items-center h-100 ">
                                    <div class="row justify-content-center align-items-center">
                                        <div class="col-auto">
                                            <div class="h2">
                                                <strong>
                                                    {{product.name}}
                                                </strong>
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <div class="row justify-content-center">
                                                <div class="col-12 align-self-start">
                                                    <a style="text-decoration: none;" type="button" class="text-dark" data-bs-toggle="modal" data-bs-target="#modalQRProduct">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-qr-code" viewBox="0 0 16 16">
                                                            <path d="M2 2h2v2H2V2Z"/>
                                                            <path d="M6 0v6H0V0h6ZM5 1H1v4h4V1ZM4 12H2v2h2v-2Z"/>
                                                            <path d="M6 10v6H0v-6h6Zm-5 1v4h4v-4H1Zm11-9h2v2h-2V2Z"/>
                                                            <path d="M10 0v6h6V0h-6Zm5 1v4h-4V1h4ZM8 1V0h1v2H8v2H7V1h1Zm0 5V4h1v2H8ZM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8H6Zm0 0v1H2V8H1v1H0V7h3v1h3Zm10 1h-1V7h1v2Zm-1 0h-1v2h2v-1h-1V9Zm-4 0h2v1h-1v1h-1V9Zm2 3v-1h-1v1h-1v1H9v1h3v-2h1Zm0 0h3v1h-2v1h-1v-2Zm-4-1v1h1v-2H7v1h2Z"/>
                                                            <path d="M7 12h1v3h4v1H7v-4Zm9 2v2h-3v-1h2v-1h1Z"/>
                                                        </svg>
                                                    </a>
                                                </div>
                                                <div class="col-12 align-self-end">
                                                    <div class="h6 text-muted mb-0">
                                                        {{product.id}}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row justify-content-center my-3">
                                        {% if product.pair %}
                                            <div class="col-12">
                                                <span class="h2">
                                                    {{product.pair_price}}$
                                                </span>
                                                <span>
                                                    <small class="text-muted pl-2">
                                                        el Par
                                                    </small>
                                                </span>
                                            </div>
                                            {% if user.is_admin or user.is_worker %}
                                                <div class="row justify-content-center">
                                                    
                                                    <div class="col-auto">
                                                        <div class="row justify-content-center">
                                                            <div class="col-auto">
                                                                <fieldset class="border px-3 my-3">
                                                                    <legend class="float-none w-auto h6 mx-auto">Pares Almacenados</legend>
                                                                    <div class="h5">
                                                                        {{product.pair_stored}}
                                                                    </div>
                                                                </fieldset>
                                                            </div>
                                                        </div>
                                                        
                                                    </div>        
                                                            
                                                    {% if product.unit_stored != 0 %}      
                                                        
                                                        <div class="col-auto">
                                                            <div class="row justify-content-center">
                                                                <div class="col-auto">
                                                                    <fieldset class="border px-3 my-3">
                                                                        <legend class="float-none w-auto h6 mx-auto">Unidades Almacenadas</legend>
                                                                        <div class="h5">
                                                                            {{product.unit_stored}}
                                                                        </div>
                                                                    </fieldset>
                                                                </div>
                                                            </div>
                                                        </div>                   
                                                    {% endif %}
                                                </div>
                                            {% endif %}
                                        {% else %}
                                            <div class="col-12">
                                                <span class="h2">
                                                    {{product.unit_price}}$
                                                </span>
                                                <span>
                                                    <small class="text-muted pl-2">
                                                        la Unidad
                                                    </small>
                                                </span>
                                            </div>
                                            {% if user.is_admin or user.is_worker %}
                                                <div class="row justify-content-center">
                                                    <div class="col-auto">
                                                        <fieldset class="border px-3 my-3">
                                                            <legend class="float-none w-auto h5 mx-auto">Unidades Almacenadas</legend>
                                                            <div class="h4">
                                                                {{product.unit_stored}}
                                                            </div>
                                                        </fieldset>
                                                    </div>                   
                                                </div>
                                            {% endif %}
                                        {% endif %}
                                    <div class="col-12 text-break">
                                        <small class="text-muted">
                                            {{product.description}}
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% comment %} CONFIRM & Adicional Info  {% endcomment %}
                        {% if user.is_worker or user.is_admin %}
                            <div class="row justify-content-center align-items-center my-4">
                                {% if not product.confirm and user.is_worker %}
                                    <div class="col-12 my-4">
                                        <a type="button" class="w-auto m-2 p-2 btn btn-info" data-bs-toggle="modal" data-bs-target="#ConfirmAddModal" data-bs-whatever="1">
                                            <span class="h2">Realizar Confirmaciones</span>
                                        </a>    
                                    </div>
                                {% endif %}
                                {% if not product.confirm and user.is_admin %}
                                    <div class="col-12 ">
                                        <div class="row justify-content-center">
                                            <div class="col-auto">
                                                <div class="w-auto m-2 p-2 bg-info" >
                                                    <span class="h2">Confirmación Pendientes</span>
                                                </div>   
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                                <div class="col-12">
                                    <button class="btn m-2  btn-sm btn-outline-secondary w-auto" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMoreInfo" aria-expanded="false" aria-controls="collapseMoreInfo">
                                        <span class="h-1"> Información Adicional </span>
                                    </button>
                                    <div class="collapse" id="collapseMoreInfo">
                                        <div class="row justify-content-center">
                                            
                                            <div class="col-auto">
                                                <hr>
                                                <div class="row justify-content-around my-3">
                                                    <div class="col-6 text-start">
                                                        <div class="h5">Categoría:</div>
                                                    </div>
                                                    <div class="col-6 text-end">
                                                        <div class="h5">{{product.sub_category.category.name}}</div>
                                                    </div>
                                                    <div class="col-6 text-start">
                                                        <div class="h5">Sub Categoría:</div>
                                                    </div>
                                                    <div class="col-6 text-end">
                                                        <div class="h5">{{product.sub_category.name}}</div>
                                                    </div>
                                                    <div class="col-6 text-start">
                                                        <div class="h5">Precio de Compra:</div>
                                                    </div>
                                                    <div class="col-6 text-end">
                                                        <div class="h5">{{product.purchase_price}}$</div>
                                                    </div>
                                                    
                                                </div>
                                                <hr>
                                            </div>
                                            <div class="col-12">
                                                <div class="row justify-content-center">
                                                    <div class="col-auto ">
                                                        <table class=" border border-1 p-2 m-2 table table-ligth table-borderless">  
                                                            <thead>
                                                                <tr>
                                                                    <th scope="col h3"></th>
                                                                    {% if product.pair %}
                                                                        <th scope="col  h3">Por Par</th>
                                                                    {% endif %}
                                                                    <th scope="col h3">Por Unidad</th>
                                                                </tr>
                                                                <tbody>
                                                                    <tr>
                                                                        <th scope="row h3">Precio</th>
                                                                        {% if product.pair %}
                                                                                <td class="h3">{{product.pair_price}}$</td>
                                                                        {% endif %}
                                                                        <td class="h3">{{product.unit_price}}$</td>
                                                                    </tr>
                                                                    {% if user.is_admin %}  
                                                                        <tr>
                                                                            <th scope="row h3">Precio de Compra</th>
                                                                            {% if product.pair %}
                                                                                <td class="h3">-</td>
                                                                            {% endif %}
                                                                            <td class="h3">{{product.purchase_price}}$</td>
                                                                            
                                                                        </tr>
                                                                    {% endif %}
                                                                    {% if user.is_admin %}  
                                                                        <tr>
                                                                            <th scope="row h3">Ganancia</th>
                                                                            {% if product.pair %}
                                                                                    <td class="h3">{{product.pair_profit}}$</td>
                                                                            {% endif %}
                                                                            <td class="h3">{{product.unit_profit}}$</td>
                                                                        </tr>
                                                                    {% endif %}
                                                                    <tr>
                                                                        <th scope="row h3">Pago a Trabajdor</th>
                                                                        {% if product.pair %}
                                                                                <td class="h3">{{product.pair_profit_worker}}$</td>
                                                                        {% endif %}
                                                                        <td class="h3">{{product.unit_profit_worker}}$</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <th scope="row h3">Total Vendido</th>
                                                                        {% if product.pair %}
                                                                            <td class="h3">{{product.pair_sold}}</td>
                                                                        {% endif %}
                                                                        <td class="h3">{{product.unit_sold}}</td>
                                                                    </tr>
                                                                    
                                                                </tbody>
                                                                
                                                            </thead>  
                                                        </table>
                                                    </div>
                                                </div>
                                                
                                            </div>
                                            
                                        </div>
                                    </div> 
                                </div>
                            </div>

                        {% endif %}
                        {% comment %} BUTONS {% endcomment %}
                        {% if user.is_admin or user.is_worker %}
                            <hr>
                            <div class="row justify-content-around align-items-center">
                                {% comment %} ADD {% endcomment %}
                                {% if user.is_admin %}
                                    <div class="col-auto my-2">
                                        <a type="button" class=" btn btn-info" data-bs-toggle="modal" data-bs-target="#AddModal" data-bs-whatever="1">
                                            Agregar
                                        </a>      
                                    </div>
                                {% endif %}
                                {% comment %} EDIT {% endcomment %}
                                {% if user.is_admin %}
                                    <div class="col-auto my-2 ">
                                        <button type="button" class=" btn btn-warning" data-bs-toggle="modal" data-bs-target="#EditModal" data-bs-whatever="1">
                                            Editar
                                        </button> 
                                    </div>
                                {% endif %}
                                
                                {% if product.confirm %}
                                    {% comment %} SELL {% endcomment %}
                                    {% if product.unit_stored > 0 or product.pair_stored > 0 %}
                                        <div class="col-auto my-2 ">
                                            <a type="button" class=" btn btn-success" data-bs-toggle="modal" data-bs-target="#SellModal" data-bs-whatever="1">
                                                Vender
                                            </a>  
                                        </div>
                                    {% endif %}
                                    {% comment %} REFUND {% endcomment %}
                                    {% if product.unit_sold > 0 or product.pair_sold > 0 %}
                                        <div class="col-auto my-2 ">
                                            <a type="button" style="background-color: orangered; color: white;" class=" btn " data-bs-toggle="modal" data-bs-target="#RefundModal" data-bs-whatever="1">
                                                Reembolsar
                                            </a>  
                                        </div>
                                    {% endif %}
                                    {% comment %} SUB {% endcomment %}
                                    {% if user.is_admin %}
                                        {% if product.unit_stored > 0 or product.pair_stored > 0 %}
                                            <div class="col-auto my-2 ">
                                                <a type="button" class=" btn btn-danger" data-bs-toggle="modal" data-bs-target="#SubModal" data-bs-whatever="1">
                                                    Quitar
                                                </a>  
                                            </div>
                                        {% endif %}
                                    {% endif %}
                                {% endif %}
                                    
                            </div>            
                        {% endif %}
                    </div>
                </div>
            </div>

            {% comment %}=================================== MODALS =================================  {% endcomment %}
            {% if user.is_admin or user.is_worker %}
                {% if user.is_admin %}
                    {% comment %} ========================= ADD ===============    {% endcomment %}
                    <div class="modal fade" data-bs-backdrop="static" id="AddModal" tabindex="-1" aria-labelledby="AddModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content p-3 m-2">
                                <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="AddModalLabel">Agregar</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <form method="POST" action="">
                                    {% csrf_token %}
                                    <div class="modal-body">
                                
                                        <div class="row">
                                            <div class="input-group mb-3">
                                                <span class="input-group-text">Agregar {% if product.pair %} Pares {% else %} Unidades {% endif %} </span>
                                                <div class="form-floating">
                                                    <input required value="1" type="number" required min="1" name="cantidad" class="form-control" id="idPairLotInput" placeholder="Cantidad">
                                                    <label for="floatingInput">Cantidad de {{product.name}}</label>        
                                                </div>
                                            </div>
                                        </div>
                                        {% if product.pair %}
                                            <div class="form-check form-switch mb-3 m-1">
                                                <input type="checkbox" class="form-check-input" id="PairAddUni" name="AccionPar" onchange="onPairAddUni()" >
                                                <label class="form-check-label">                   
                                                    Agregar Unidades
                                                </label>
                                            </div>
                                            <div class="input-group mb-3" id="divIdCantUni" style="display: none;">
                                                <span class="input-group-text">Agregar Unidades</span>
                                                <div class="form-floating">
                                                    <input required value="1"  type="number" min="1" name="cantidad_1" class="form-control" id="PairAddUnitInput" placeholder="Cantidad Unidades">
                                                    <label for="floatingInput">Cantidad de Unidades de {{product.name}}</label>        
                                                </div>
                                            </div>
                                        {% endif %}
                                        <div class="form-floating mb-3">
                                            <textarea  type="text" class="form-control" maxlength="100" name="nota" id="floatingInput" placeholder="Nota Adicional"  style="height: 100px;"></textarea >
                                            <label for="floatingInput">Nota Adicional</label>
                                        </div>
                                        <div class="row justify-content-around m-2">
                                            <div class="col-auto">
                                                <div class="row justify-content-center">
                                                    <div class="col-auto">
                                                        <input type="reset" class="btn btn-secondary" data-bs-dismiss="modal" value="Cancelar">   
                                                    </div>
                                                </div>
                                                        
                                            </div>
                                            <div class="col-auto">
                                                <div class="row justify-content-center">
                                                    <div class="col-auto">
                                                        <input type="submit"  name="AddProduct" class="btn btn-info" value="Agregar">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div> 
                                </form>
                            </div>
                        </div>
                    </div>
                    {% comment %} ========================= REMOVE ===============    {% endcomment %}
                    <div class="modal fade" data-bs-backdrop="static" id="RemoveModal" tabindex="-1" aria-labelledby="RemoveModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="RemoveModalLabel">Eliminar</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form method="POST" action="">
                                        {% csrf_token %}
                                        <div class="modal-body text-center">
                                            <div class="h3 text-danger">Eliminar {{product.name}} </div>
                                        </div>
                                        <div class="form-floating mb-3">
                                            <textarea  type="text" class="form-control" maxlength="100" name="nota" id="floatingInput" placeholder="Nota Adicional"  style="height: 100px;"></textarea >
                                            <label for="floatingInput">Nota Adicional</label>
                                        </div>
                                        <div class="modal-footer">
                                            <input type="reset" class="btn btn-secondary" data-bs-dismiss="modal" value="Cancelar">
                                            <input class=" btn btn-danger" type="submit" name="RemoveProduct" value="Eliminar">
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% comment %} ========================= EDIT =================== {% endcomment %}
                    <div class="modal fade" id="EditModal" data-bs-backdrop="static" tabindex="-1" aria-labelledby="EditModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="EditModalLabel">Editar {{product.name}}</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <form method="POST" action="" enctype=multipart/form-data>
                                    {% csrf_token %}
                                    <div class="modal-body">
                                        <div class="form-floating mb-3">
                                            <input required type="text" maxlength="30" class="form-control" name="name" id="floatingInput" placeholder="Nombre" value="{{product.name}}">
                                            <label for="floatingInput">Nombre</label>
                                        </div>
                                        <div class="form-floating mb-3">
                                            <input required value="{{product.purchase_price}}" min="1" type="number"  class="form-control"  name="precio compra"id="PrecioCompra" placeholder="Precio de Compra">
                                            <label for="floatingInput">Precio de Compra </label>
                                        </div>  
                                        {% comment %} <div class="form-floating mb-3">
                                            <input required type="text" maxlength="4" class="form-control" name="id" id="floatingInput" placeholder="Id" value="{{product.id}}">
                                            <label for="floatingInput">Id</label>
                                        </div> {% endcomment %}
                                        {% if product.pair %}
                                            <fieldset class="border p-2 m-1">
                                                <legend  class="float-none w-auto">Por Pares</legend> 

                                                <div class="form-floating mb-3">
                                                    <input required min="0" type="number" value="{{product.pair_price}}" class="form-control"  name="precio pares" placeholder="Precio">
                                                    <label for="floatingInput">Precio por Par </label>
                                                </div>
                                                <div class="form-floating mb-3">
                                                    <input required min="0" type="number" value="{{product.pair_profit}}" class="form-control"  name="ganancia pares" placeholder="Ganancia">
                                                    <label for="floatingInput">Ganancia por Par </label>
                                                </div>
                                                <div class="form-floating mb-3">
                                                    <input required min="0" type="number" value="{{product.pair_profit_worker}}"  class="form-control"  name="ganancia pares trabajador" id="ParesGanancia" placeholder="Pago a Trabajador">
                                                    <label for="floatingInput">Pago a Trabajador por Par</label>
                                                </div>
                                                
                                                    
                                                </fieldset>
                                        {% endif %}
                                        <fieldset class="border p-2 m-1">
                                            <legend  class="float-none w-auto">Por Unidad</legend> 

                                            <div class="form-floating mb-3">
                                                <input required min="0" type="number" value="{{product.unit_price}}" class="form-control"  name="precio unitario" placeholder="Precio">
                                                <label for="floatingInput">Precio por Unidad </label>
                                            </div>
                                            <div class="form-floating mb-3">
                                                <input required min="0" type="number" value="{{product.unit_profit}}" class="form-control"  name="ganancia unitario" placeholder="Ganancia">
                                                <label for="floatingInput">Ganancia por Unidad </label>
                                            </div>
                                            <div class="form-floating mb-3">
                                                <input required min="0" type="number" value="{{product.unit_profit_worker}}"  class="form-control"  name="ganancia unitario trabajador" id="ParesGanancia" placeholder="Pago a Trabajador">
                                                <label for="floatingInput">Pago a Trabajador por Unidad </label>
                                            </div>    
                                            
                                            
                                        </fieldset>

                                        <div class="form-floating mb-3">
                                            <textarea  type="text" class="form-control" name="descripción" id="floatingInput" placeholder="Descripción"  style="height: 100px;">{{product.description}}</textarea >
                                            <label for="floatingInput">Descripción</label>
                                        </div>
                                        <div class="form-floating mb-3">
                                            <div class="row m-2">
                                                Imagen
                                            </div>
                                            <div class="row">
                                                <div class="col-12" id="ImgDiv">
                                                    <div id="divid">
                                                        <input src="{% if product.image %} {{product.image.url}} {% endif %}" onchange="PrevImg()" type="file"  class="form-control " name="imagen" id="inputImgPre" placeholder="Imagen">
                                                    </div>
                                                </div> 
                                                
                                            </div>
                                            <div class="d-flex justify-content-around m-3">
                                                <img id="imgPre" src="{% if product.image %} {{product.image.url}} {% endif %}" class="img-fluid"  alt=" " >
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row justify-content-around m-2">
                                        <div class="col-auto">
                                            <div class="row justify-content-center">
                                                <div class="col-auto">
                                                    <input type="reset" class="btn btn-secondary" data-bs-dismiss="modal" value="Cancelar">   
                                                </div>
                                            </div>
                                                    
                                        </div>
                                        <div class="col-auto">
                                            <div class="row justify-content-center">
                                                <div class="col-auto">
                                                    <input class="btn btn-warning" type="submit" name="EditProduct" value="Editar">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% comment %} <div class="modal-footer">
                                        <input type="reset" class="btn btn-secondary" data-bs-dismiss="modal" value="Cancelar">
                                        <input class="btn btn-warning" type="submit" name="EditProduct" value="Editar">
                                    </div> {% endcomment %}
                                </form>
                            </div>
                        </div>
                    </div>   
                {% endif %}
                {% if product.confirm %}            
                    {% comment %} ========================= SELL ===============    {% endcomment %}
                    {% if product.unit_stored > 0 or product.pair_stored > 0 %}
                        <div class="modal fade" data-bs-backdrop="static" id="SellModal" tabindex="-1" aria-labelledby="SellModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content p-3 m-2">
                                    <div class="modal-header">
                                        <h1 class="modal-title fs-5" id="SellModalLabel">Vender</h1>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <form method="POST"  action="">
                                        {% csrf_token %}
                                        <div class="modal-body">
                                    
                                            <div class="row">
                                                <div class="input-group mb-3">
                                                    <span class="input-group-text">Vender</span>
                                                    <div class="form-floating">
                                                        <input  required type="number"  oninput="ChangeSellLot('{{product.pair}}','{{product.pair_price}}','{{product.pair_profit}}','{{product.pair_profit_worker}}','{{product.unit_price}}','{{product.unit_profit}}','{{product.unit_profit_worker}}')" value="1" min="1" max="{% if product.pair %}{{product.pair_stored}} {% else %}{{product.unit_stored}}{% endif %} " name="cantidad" class="form-control" id="idLotatChange" placeholder="Cantidad">
                                                        
                                                        {% if product.pair == True %} 
                                                            <input type="hidden" id="HiddenInptMaxMin"value="{{product.unit_stored}}">
                                                        {% endif %}
                                                        <label for="floatingInput">Cantidad</label>       
                                                    </div>
                                                </div>
                                            </div>
                                            {% if product.pair %}
                                                <div class="form-check form-switch mb-3 m-1">
                                                    <input onclick="ChangeSellLot('{{product.pair}}','{{product.pair_price}}','{{product.pair_profit}}','{{product.pair_profit_worker}}','{{product.unit_price}}','{{product.unit_profit}}','{{product.unit_profit_worker}}')" id="VentaPresId" type="checkbox" class="form-check-input" name="AccionPar" checked >
                                                    <label class="form-check-label">                   
                                                        Venta por Pares
                                                    </label>
                                                </div>
                                            {% endif %}    
                                            <div class="form-floating mb-3">
                                                <textarea  type="text" class="form-control" maxlength="100" name="nota" id="floatingInput" placeholder="Nota Adicional"  style="height: 100px;"></textarea >
                                                <label for="floatingInput">Nota Adicional</label>
                                            </div>
                                            <div class="row justify-content-around m-2">
                                                <div class="col-auto">
                                                    <div class="row justify-content-center">
                                                        <div class="col-auto">
                                                            <input type="reset" class="btn btn-secondary" data-bs-dismiss="modal" value="Cancelar">   
                                                        </div>
                                                    </div>
                                                            
                                                </div>
                                                <div class="col-auto">
                                                    <div class="row justify-content-center">
                                                        <div class="col-auto">
                                                            <input type="submit"  name="SellProduct" class="btn btn-success" value="Vender">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>    
                                    </form>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    {% comment %} ========================= REFUND ===============    {% endcomment %}
                    {% if product.unit_sold > 0 or product.pair_sold > 0 %}
                        <div class="modal fade" data-bs-backdrop="static" id="RefundModal" tabindex="-1" aria-labelledby="RefundModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content p-3 m-2">
                                    <div class="modal-header">
                                        <h1 class="modal-title fs-5" id="RefundModalLabel">Reembolsar</h1>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <form method="POST" action="">
                                        {% csrf_token %}
                                        <div class="modal-body">
                                    
                                            <div class="row">
                                                <div class="h6 mx-4 p-1">Id de Operación a Reembolsar</div>
                                                <div class="input-group mb-3">
                                                    <input type="number" class="form-control" name="RefundIdMovement" min="1"  placeholder="Id" id="inputIdVerifRefund" aria-label="Recipient's username" aria-describedby="basic-addon2">
                                                    <div class="input-group-append">
                                                    <button class="btn btn-outline" style="background-color: orangered; color: white;" onClick="VerifRefund('{% url 'base_post' %}',{{product.id}})" type="button">Verificar</button>
                                                    </div>
                                                </div>
                                                <div class="container text-center m-1 p-1">
                                                    <div id="IdSpiner" class="d-none">
                                                        <div class="row justify-content-center align-items-center text-center">
                                                            <div class="col">
                                                                <div class="spinner-border" role="status">
                                                                    <span class="sr-only"></span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div  class="h5 p-1 mx-4"id="DivIdInfoRefundAjax">
                                                        
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-floating mb-3">
                                                <textarea  type="text" class="form-control" maxlength="100" name="nota" id="floatingInput" placeholder="Nota Adicional"  style="height: 100px;"></textarea >
                                                <label for="floatingInput">Nota Adicional</label>
                                            </div>
                                            <div class="row justify-content-around m-2">
                                                <div class="col-auto">
                                                    <div class="row justify-content-center">
                                                        <div class="col-auto">
                                                            <input type="reset" class="btn btn-warning" data-bs-dismiss="modal" value="Cancelar"> 
                                                        </div>
                                                    </div>
                                                            
                                                </div>
                                                <div class="col-auto">
                                                    <div class="row justify-content-center">
                                                        <div class="col-auto">
                                                            <input type="submit" disabled id="RefundProductButton" name="RefundProduct" style="background-color: orangered; color: white;" class="btn" value="Reembolsar"> 
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>       
                                    </form>  
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    {% comment %} ========================= SUB ===============    {% endcomment %}
                    {% if user.is_admin %}
                        {% if product.unit_stored > 0 or product.pair_stored > 0 %}
                            <div class="modal fade" data-bs-backdrop="static" id="SubModal" tabindex="-1" aria-labelledby="SubModalLabel" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content p-3 m-2">
                                        <div class="modal-header">
                                            <h1 class="modal-title fs-5" id="SubModalLabel">Quitar</h1>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <form method="POST" action="">
                                            {% csrf_token %}
                                            <div class="modal-body">
                                    
                                                <div class="row">
                                                    <div class="input-group mb-3">
                                                        <span class="input-group-text">Quitar</span>
                                                        <div class="form-floating">
                                                            <input required type="number" value="1" min="1" max="{% if product.pair %}{{product.pair_stored}} {% else %}{{product.unit_stored}}{% endif %}" name="cantidad" class="form-control" id="floatingInput" placeholder="Cantidad">
                                                            <label for="floatingInput">Cantidad</label>       
                                                        </div>
                                                    </div>
                                                </div>  
                                                {% if product.pair %}
                                                    <div class="form-check form-switch mb-3 m-1">
                                                        <input type="checkbox" class="form-check-input" name="AccionPar" checked >
                                                        <label class="form-check-label">                   
                                                            Quitado por Pares
                                                        </label>
                                                    </div>
                                                {% endif %} 
                                                <div class="form-floating mb-3">
                                                    <textarea  type="text" class="form-control" maxlength="100" name="nota" id="floatingInput" placeholder="Nota Adicional"  style="height: 100px;"></textarea >
                                                    <label for="floatingInput">Nota Adicional</label>
                                                </div>

                                                <div class="row justify-content-around m-2">
                                                    <div class="col-auto">
                                                        <div class="row justify-content-center">
                                                            <div class="col-auto">
                                                                <input type="reset" class="btn btn-secondary" data-bs-dismiss="modal" value="Cancelar">   
                                                            </div>
                                                        </div>
                                                                
                                                    </div>
                                                    <div class="col-auto">
                                                        <div class="row justify-content-center">
                                                            <div class="col-auto">
                                                                <input type="submit"  name="SubProduct" class="btn btn-danger" value="Quitar">
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>   
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    {% endif %}
                {% endif %}
                {% comment %} ========================== REPLICA =================== {% endcomment %}
                {% if user.is_admin %}
                {% comment %} <div class="modal fade" id="modalId" tabindex="-1" role="dialog" aria-labelledby="modalTitleId" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="modalTitleId">Replicar</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="container-fluid">
                                    <form action="" method="post" id="IDFormREplica">
                                        {% csrf_token %}
                                        <div class="row justify-content-center align-items-center ">
                                            <div class="col-auto">
                                                <input type="submit" class="btn btn-info btn-lg" value="Replicar Producto" name="ReplicaProduct">
                                            </div>
                                        </div>
                                        
                                        <input type="hidden" name="ReplicaProduct">
                                    </form>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div> {% endcomment %}
                {% endif %}
                {% comment %} =================  CONFIRM  ==================== {% endcomment %}   
                {% if not product.confirm and user.is_worker%}
                    <div class="modal fade" data-bs-backdrop="static" id="ConfirmAddModal" tabindex="-1" aria-labelledby="ConfirmAddModalLabel" aria-hidden="true">
                        <div class="modal-dialog ">
                            <div class="modal-content p-3 m-2">
                                <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="ConfirmAddModalLabel">Confirmar Entradas</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    {% for movement in MovementsConfirm %}
                                        <div class="row justify-content-center">
                                            <form method="POST" action=""  enctype=multipart/form-data>
                                                {% csrf_token %}
                                                <div class="row border m-2">
                                                    <h5 class="m-1 mt-2 h5">Producto: {{movement.product.name}}</h5>
                                                    <h6 class="m-1 h5">Cantidad a Ingresar: 
                                                        <strong >
                                                            {{movement.lot}}   
                                                            {% if movement.extra_info_int == 1 %}
                                                                Pares
                                                            {% elif movement.extra_info_int == 2 %}    
                                                                Pares + {{movement.extra_info_int_1}} Unidades   
                                                            {% else %}
                                                                Unidades
                                                            {% endif %}
                                                         
                                                        </strong>
                                                    </h6>
                                                    {% if movement.extra_info_str %}
                                                    <h6 class="m-1 h6">Nota: <small class="text-muted" > {{movement.extra_info_str}}</small></h6>
                                                    {% endif %}
                                                    <h6 class="m-1 h6">Fecha: <small class="text-muted" > {{movement.date}}</small></h6>
                                                    <input type="hidden" name="MovimientoID" value="{{movement.id}}">
                                                    <div class="form-floating mb-3">
                                                        <textarea  type="text" class="form-control" maxlength="100" name="nota" id="floatingInput" placeholder="Nota Adicional"  style="height: 100px;"></textarea >
                                                        <label for="floatingInput">Nota Adicional</label>
                                                    </div>
                                                    
                                                    <div class="row justify-content-center m-2">
                                                        <input type="submit"  name="ConfirmAddProduct" class="btn btn-info float-end mx-2 w-75" value="Confirmar">
                                                    </div>      
                                                </div>
                                            </form>
                                        </div>      
                                    {% endfor %}
                                </div>
                                <div class="modal-footer">
                                    <div class="row justify-content-center px-2">
                                        <input type="reset" class="btn btn-secondary" data-bs-dismiss="modal" value="Cancelar">   
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
                
            {% endif %} 
            {% comment %} ====================QR============== {% endcomment %}
            <div class="modal fade" id="modalQRProduct" tabindex="-1" role="dialog" aria-labelledby="modalTitleId" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title text-center" id="modalTitleId">{{product.name}} <span class="ml-3 text muted h6"><small>id:{{product.id}}</small></span> </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            
                        </div>
                        <div class="modal-body">
                            <div class="row justify-content-center align-items-center h-100">
                                <div class="col-auto m-5">
                                    <div id="qrcode">
                                    </div>  
                                </div>
                            </div>
                            
                        </div>
                    </div>
                </div>
            </div>
            {% if user.is_admin or user.is_worker %}   
                <div class="display-2 my-5 text-center">  Operaciones </div>
                {% comment %} =================  TABLE OPERATIONS ==================== {% endcomment %}
                
                {% include 'BaseMovementsTable.html' with ProductPage="1" %}
                {% if user.is_admin %}
                    <div class="row ">
                        <div class="col">
                            
                            <button type="button" class="float-end btn btn-danger m-3 p-2" data-bs-toggle="modal" data-bs-target="#RemoveModal" data-bs-whatever="0">Eliminar Producto: {{product.name}}</button>
                        
                        </div>
                    </div>
                {% endif %}
            {% endif %}     
        </div>
    {% else %}
        <meta http-equiv="Refresh" content="0; url='{% url 'home' %}'" />
    {% endif %}

{% endblock  %}
{% block script_js %}
    <script type="text/javascript" src="{% static 'js/create_product.js' %}" ></script>
    <script type="text/javascript" src="{% static 'js/product.js' %}" ></script>
    <script type="text/javascript" src="{% static 'js/base_prev_img.js' %}" ></script>
    <script type="text/javascript" src="{% static 'qrcodejs/jquery.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'qrcodejs/qrcode.js' %}"></script>
    <script type="text/javascript">
        new QRCode(document.getElementById("qrcode"), "{{product_qr_url}}");
    </script>
{% endblock  %}